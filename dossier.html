<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enval – Dossier</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      .statusbar { display:flex; gap:12px; align-items:center; justify-content:space-between; }
      .pill { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:600; font-size:0.85rem; border:1px solid #cbd5e1; background:#fff; }
      .pill.ok { border-color:#22c55e; }
      .pill.warn { border-color:#f59e0b; }
      .pill.err { border-color:#ef4444; }
      .muted { color:#64748b; }
      .grid2 { display:grid; gap:16px; }
      @media (min-width:768px){ .grid2 { grid-template-columns: 1fr 1fr; } }
      .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
      .table { width:100%; border-collapse:collapse; }
      .table th, .table td { border-bottom:1px solid #e2e8f0; padding:10px 6px; text-align:left; font-size:0.95rem; }
      .table th { font-size:0.85rem; color:#64748b; font-weight:600; }
      .right { text-align:right; }
      .small { font-size:0.85rem; }
      .hidden { display:none !important; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
  </head>

  <body>
    <header>
      <div class="container header-inner">
        <div class="logo"><a href="/index.html">Enval</a></div>
        <nav>
          <a href="/index.html">Home</a>
          <a href="/hoe-het-werkt.html">Hoe het werkt</a>
          <a href="/regelgeving.html">Regelgeving</a>
          <a href="/index.html#contact">Contact</a>
        </nav>
      </div>
    </header>

    <main>
      <section class="section">
        <div class="container">
          <div class="card">
            <div class="statusbar">
              <div>
                <h1 style="margin:0 0 6px 0;">Jouw Enval dossier</h1>
                <div class="muted small">
                  Dossier: <span id="dossierId" class="mono">-</span>
                </div>
              </div>
              <div class="row">
                <span id="statusPill" class="pill">laden…</span>
                <button id="btnRefresh" class="btn outline" type="button">Ververs</button>
              </div>
            </div>

            <div style="margin-top:14px;">
              <div class="muted">
                Vul onderstaande stappen in. Na elke stap herberekenen we automatisch de dossierstatus.
              </div>
            </div>
          </div>

          <div class="grid2" style="margin-top:18px;">
            <div class="card">
              <h2 style="margin-top:0;">1) Toegang</h2>
              <div id="emailState" class="muted">laden…</div>
              <div class="small muted" style="margin-top:10px;">
                Deze dossierlink bevestigt toegang. Extra e-mail verificatie is uitgeschakeld.
              </div>
            </div>

            <div class="card">
              <h2 style="margin-top:0;">2) Adres</h2>
              <form id="addressForm" class="form" novalidate>
                <label><span>Postcode</span><input type="text" name="postcode" placeholder="1234AB" required /></label>
                <label><span>Huisnummer</span><input type="text" name="house_number" placeholder="28" required /></label>
                <label><span>Toevoeging (optioneel)</span><input type="text" name="suffix" placeholder="1H" /></label>

                <!-- Read-only: wordt gevuld door verify -->
                <label><span>Straat</span><input type="text" name="street_ro" readonly /></label>
                <label><span>Plaats</span><input type="text" name="city_ro" readonly /></label>

                <div class="row">
                  <button id="btnAddressSave" type="submit" class="btn primary" disabled>Opslaan</button>
                  <!-- knop blijft bestaan maar verborgen; jij wil geen handmatige check -->
                  <button id="btnVerifyAddress" class="btn outline" type="button" style="display:none;">Adres controleren</button>
                </div>

                <div id="addressState" class="small muted"></div>
              </form>

            </div>

            <div class="card">
              <h2 style="margin-top:0;">3) Laadpaal</h2>
              <form id="chargerForm" class="form" novalidate>
                <input type="hidden" name="charger_id" />
                <label><span>Serienummer (verplicht)</span><input type="text" name="serial_number" placeholder="SN123456" required /></label>

                <label><span>Merk</span><select id="chargerBrand" required></select></label>
                <label><span>Model</span><select id="chargerModel" required></select></label>

                <label><span>Vermogen kW (optioneel)</span><input type="text" name="power_kw" placeholder="11" /></label>

                <label id="chargerNotesRow" class="hidden"><span>Toelichting (verplicht bij Anders)</span><input type="text" name="notes" placeholder="Vul merk en model in (bijv. MyBrand X200)" /></label>


                <div class="row">
                  <button type="submit" class="btn primary">Laadpaal opslaan</button>
                </div>
              </form>

              <div style="margin-top:14px;">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Serienummer</th>
                      <th>Merk</th>
                      <th>Model</th>
                      <th class="right">Acties</th>
                    </tr>
                  </thead>
                  <tbody id="chargersTbody">
                    <tr><td colspan="4" class="muted">laden…</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="card">
              <h2 style="margin-top:0;">4) Documenten uploaden</h2>
              <div class="muted small">Upload je document. We maken eerst een upload-url aan, daarna upload je direct naar opslag.</div>

              <form id="uploadForm" class="form" novalidate>
                <label>
                  <span>Type document</span>
                  <select name="doc_type" required>
                    <option value="">Kies…</option>
                    <option value="factuur">Factuur Installatie (incl. Serienummer + Adres)</option>
                    <option value="foto_laadpunt">Foto Laadpunt (incl. Serienummer)</option>
                   <!--  <option value="mandaat">Mandaat</option>
                    <option value="id">ID</option>
                    <option value="kvk">KVK</option>
                    <option value="overig">Overig</option> -->
                  </select>
                </label>

                <label><span>Bestand</span><input type="file" name="file" required /></label>

                <button class="btn primary" type="submit">Upload</button>
                <div id="uploadState" class="small muted"></div>
              </form>

              <div style="margin-top:14px;">
                <div class="muted small" style="margin-bottom:8px;">Geüploade documenten</div>
                <div id="docsList" class="small muted">laden…</div>
              </div>
            </div>

            <div class="card">
              <h2 style="margin-top:0;">5) Toestemmingen</h2>

              <form id="consentsForm" class="form" novalidate>
                <div class="checkbox-row">
                  <input type="checkbox" id="cTerms" />
                  <label for="cTerms">
                    Ik ga akkoord met de
                    <a href="/voorwaarden.html" target="_blank" rel="noopener noreferrer">voorwaarden</a>
                  </label>
                </div>

                <div class="checkbox-row">
                  <input type="checkbox" id="cPrivacy" />
                  <label for="cPrivacy">
                    Ik ga akkoord met de
                    <a href="/privacyverklaring.html" target="_blank" rel="noopener noreferrer">privacyverklaring</a>
                  </label>
                </div>

                <div class="checkbox-row">
                  <input type="checkbox" id="cMandaat" />
                  <label for="cMandaat">
                    Ik geef middels dit mandaat aan Enval toestemming.
                    <a href="/mandaat.html" target="_blank" rel="noopener noreferrer">Lees mandaat</a>
                  </label>
                </div>

                <button class="btn primary" type="submit">Opslaan</button>

                <div id="consentsState" class="small muted"></div>
                <div id="consentsStamp" class="small muted"></div>
              </form>
            </div>


            <div class="card">
              <h2 style="margin-top:0;">Dossierstatus</h2>
              <div id="statusExplain" class="muted small">laden…</div>

              <div class="row" style="margin-top:10px;">
                <button id="btnEvaluate" class="btn outline" type="button">Review dossier</button>
              </div>

              <div class="small muted" style="margin-top:10px;">
                Na review worden controles uitgevoerd. Als alles klopt kan dit dossier door naar inboeken.
              </div>
            </div>

          </div>

          <div style="height:24px;"></div>
        </div>
      </section>
    </main>

    <footer>
      <div class="container footer-inner">
        <p>&copy; <span id="year"></span> Enval. Alle rechten voorbehouden.</p>
      </div>
    </footer>

    <!-- BELANGRIJK: config eerst -->
    <script src="/config.js"></script>
    <script src="/dossier.js"></script>
  </body>
</html>
